# DEVELOPMENT ENVIRONMENT — GRAIN

## Overview

This document defines the development environment for building GRAIN, a micro-harmonic saturation processor delivered as a VST3 plugin and standalone application for macOS Apple Silicon.

---

## 1. System Requirements

| Component | Specification |
|-----------|---------------|
| **OS** | macOS Tahoe (26.x) |
| **Architecture** | Apple Silicon (ARM64) |
| **Xcode** | 16.x or later (required for compilation and code signing) |
| **Xcode Command Line Tools** | Required |

### Verify your system

```bash
# Check macOS version
sw_vers

# Check architecture
uname -m  # Should return: arm64

# Check Xcode installation
xcode-select -p

# Install Command Line Tools if needed
xcode-select --install
```

---

## 2. Framework: JUCE

### 2.1 Why JUCE

- Industry standard for audio plugin development
- Abstracts VST3/AU/Standalone builds
- Extensive documentation and community support
- Projucer tool generates Xcode projects automatically

### 2.2 Installation

**Option A: Download (Recommended)**

1. Go to [https://juce.com/download/](https://juce.com/download/)
2. Download JUCE for macOS
3. Extract to a permanent location (e.g., `~/JUCE`)

**Option B: Git Clone**

```bash
cd ~
git clone https://github.com/juce-framework/JUCE.git
```

### 2.3 Verify installation

```bash
# Check JUCE directory structure
ls ~/JUCE
# Should contain: docs/, examples/, extras/, modules/, Projucer.app, etc.
```

### 2.4 Projucer setup

1. Open `~/JUCE/Projucer.app`
2. Go to **Projucer → Global Paths**
3. Set:
   - **Path to JUCE:** `~/JUCE`
   - **JUCE Modules:** `~/JUCE/modules`

### 2.5 License

JUCE is free under:
- **GPL v3** for open source projects
- **Personal license** for projects under $50k annual revenue
- Commercial license required above that threshold

GRAIN will use GPL v3 (open source).

---

## 3. Language & Compiler

| Component | Version |
|-----------|---------|
| **Language** | C++17 (minimum) |
| **Compiler** | Apple Clang (bundled with Xcode) |
| **Build System** | Xcode project (generated by Projucer) |

### Verify compiler

```bash
clang++ --version
# Should show Apple clang version 16.x or later
```

---

## 4. Editors & IDE

### 4.1 Primary workflow

| Tool | Purpose |
|------|---------|
| **Neovim / Zed** | Code editing |
| **Xcode** | Compilation, debugging, code signing |
| **Projucer** | Project configuration, adding files |

### 4.2 LSP Setup for Neovim/Zed

For intelligent code completion and diagnostics, configure `clangd`.

**Generate compile_commands.json from Xcode:**

```bash
# Install xcpretty if needed
gem install xcpretty

# After building once in Xcode, generate compilation database
cd ~/Projects/GRAIN/Builds/MacOSX

# Option 1: Using xcodebuild
xcodebuild -project GRAIN.xcodeproj -scheme "GRAIN - VST3" \
  -configuration Debug \
  build | xcpretty -r json-compilation-database -o compile_commands.json

# Option 2: Using Bear (recommended)
brew install bear
bear -- xcodebuild -project GRAIN.xcodeproj -scheme "GRAIN - VST3" -configuration Debug build
```

**Symlink to project root:**

```bash
ln -s Builds/MacOSX/compile_commands.json ~/Projects/GRAIN/compile_commands.json
```

### 4.3 Neovim configuration (nvim-lspconfig)

```lua
require('lspconfig').clangd.setup{
  cmd = { "clangd", "--background-index" },
  filetypes = { "c", "cpp", "objc", "objcpp" },
  root_dir = require('lspconfig.util').root_pattern(
    'compile_commands.json',
    '.git'
  ),
}
```

### 4.4 Zed configuration

Zed detects `compile_commands.json` automatically. Ensure it's at the project root.

---

## 5. Testing Environment

### 5.1 Supported DAWs

| DAW | VST3 Support | Notes |
|-----|--------------|-------|
| **Logic Pro** | ✅ | Scans `~/Library/Audio/Plug-Ins/VST3/` |
| **Ableton Live** | ✅ | Scans same location |
| **REAPER** | ✅ | Free trial, excellent for plugin development |

### 5.2 Not recommended

| DAW | Reason |
|-----|--------|
| **Audacity** | No native VST3 support (uses VST2/LV2 only) |

### 5.3 VST3 installation path

```bash
# System-wide (requires admin)
/Library/Audio/Plug-Ins/VST3/

# User-specific (recommended for development)
~/Library/Audio/Plug-Ins/VST3/
```

### 5.4 Rescan plugins

- **Logic Pro:** Close and reopen, or restart
- **Ableton Live:** Preferences → Plug-Ins → Rescan
- **REAPER:** Options → Preferences → Plug-ins → Re-scan

---

## 6. Version Control

### 6.1 Repository

| Platform | Repository |
|----------|------------|
| **GitHub** | `https://github.com/[username]/GRAIN` |

### 6.2 .gitignore for JUCE projects

```gitignore
# Build artifacts
Builds/
JuceLibraryCode/

# Xcode
*.xcuserstate
*.xcworkspace
xcuserdata/
DerivedData/

# Projucer backup
*.jucer.bak

# macOS
.DS_Store

# Editor
.vscode/
.idea/
*.swp
*.swo

# Compiled plugins (optional - may want to track releases)
*.vst3
*.component
```

---

## 7. Project Structure

```
GRAIN/
├── GRAIN.jucer              # Projucer project file
├── Source/
│   ├── PluginProcessor.h    # Audio processing logic
│   ├── PluginProcessor.cpp
│   ├── PluginEditor.h       # GUI (minimal for MVP)
│   └── PluginEditor.cpp
├── Builds/
│   └── MacOSX/
│       └── GRAIN.xcodeproj  # Generated by Projucer
├── JuceLibraryCode/         # Generated by Projucer
├── docs/
│   ├── DELIVERABLE_EN.md
│   ├── DEVELOPMENT_ENVIRONMENT.md
│   └── ...
├── compile_commands.json    # Symlink for LSP
├── .gitignore
└── README.md
```

---

## 8. Development Workflow

### 8.1 Initial setup (once)

```bash
# 1. Create project in Projucer
#    - Open Projucer.app
#    - File → New Project → Audio Plug-In
#    - Configure: VST3 + Standalone, C++17
#    - Save to ~/Projects/GRAIN

# 2. Open in Xcode
#    - Projucer: "Save and Open in IDE"

# 3. Build once to generate compilation database
#    - Xcode: Product → Build (Cmd+B)

# 4. Generate compile_commands.json (see section 4.2)

# 5. Open in Neovim/Zed for editing
```

### 8.2 Daily workflow

```bash
# Edit code in Neovim/Zed
nvim Source/PluginProcessor.cpp

# Build in Xcode (or from terminal)
xcodebuild -project Builds/MacOSX/GRAIN.xcodeproj \
  -scheme "GRAIN - VST3" \
  -configuration Debug \
  build

# Plugin is built to:
# ~/Library/Audio/Plug-Ins/VST3/GRAIN.vst3

# Test in DAW
open -a "Logic Pro"
```

### 8.3 Build configurations

| Configuration | Oversampling | Use case |
|---------------|--------------|----------|
| **Debug** | 2× | Development, testing |
| **Release** | 2× real-time, 4× offline | Distribution |

---

## 9. Troubleshooting

### Plugin not appearing in DAW

```bash
# Verify plugin exists
ls -la ~/Library/Audio/Plug-Ins/VST3/GRAIN.vst3

# Check code signature (if signed)
codesign -dv --verbose=4 ~/Library/Audio/Plug-Ins/VST3/GRAIN.vst3

# Validate VST3 structure
pluginval --validate ~/Library/Audio/Plug-Ins/VST3/GRAIN.vst3
```

### clangd not finding headers

1. Ensure `compile_commands.json` exists at project root
2. Rebuild project in Xcode
3. Regenerate compilation database
4. Restart LSP server

### Xcode signing issues

For development, disable signing:
- Xcode → Project Settings → Signing & Capabilities
- Set **Signing Certificate** to "Sign to Run Locally"

---

## 10. Optional Tools

| Tool | Purpose | Installation |
|------|---------|--------------|
| **pluginval** | Plugin validation | `brew install pluginval` or [download](https://github.com/Tracktion/pluginval) |
| **REAPER** | Lightweight DAW for testing | [reaper.fm](https://www.reaper.fm/) |
| **Bear** | Generate compile_commands.json | `brew install bear` |

---

## Checklist

- [ ] macOS Tahoe + ARM64 confirmed
- [ ] Xcode 16.x installed
- [ ] Command Line Tools installed
- [ ] JUCE downloaded to `~/JUCE`
- [ ] Projucer global paths configured
- [ ] Git repository created
- [ ] .gitignore configured
- [ ] DAW(s) installed for testing
- [ ] LSP configured in editor

---

## Document History

| Version | Date | Changes |
|---------|------|---------|
| 1.0 | [Date] | Initial version |
